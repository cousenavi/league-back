(function(){$(function(){var e,t,n;return n={login:function(){return'<div id="loginForm">\n<input type="text" data-value="login" placeholder=\'login\' autofocus=\'true\'><br><br>\n<input type="password" data-value="password" placeholder=\'password\'><br><br>\n<button id="loginBtn">Go!</button>\n</div>'},matches:function(e){var t;return function(){var n,a,r;for(r=[],n=0,a=e.length;a>n;n++)t=e[n],r.push("<button id='"+t._id+"'class='match'>"+t.homeTeamName+" - "+t.awayTeamName+"<br><span class='littleText'>"+t.date+" "+t.time+" "+t.placeName+"</span></button><br>");return r}().join("")},game:function(e){var t,n;return'<div id="homeTeam">\n  <b>'+e.homeTeam.name+"</b>\n  "+function(){var a,r;a=e.homeTeam.players,r=[];for(t in a)n=a[t],r.push("<button id='"+t+"' class='player homePlayer'>"+n[0]+" "+n[1]+"</button>");return r}().join("")+'\n  <button id="saveHomeTeamBtn">OK</button>\n</div>\n\n<div id="awayTeam" style=\'display: none\'>\n  '+function(){var a,r;a=e.awayTeam.players,r=[];for(t in a)n=a[t],r.push("<button id='"+t+"' class='player awayPlayer'>"+n[0]+" "+n[1]+"</button>");return r}().join("")+'\n  <button id="saveAwayTeamBtn">OK</button>\n</div>'},events:function(){return'<button class="event" id="goalEvent">Гол</button><br>\n<button class="event" id="yellowEvent">Жк</button><br>\n<button class="event" id="redEvent">Кк</button><br>\n<button class="event" id="endEvent">Конец матча</button><br>'},goalEvent:function(){return""},yellowEvent:function(){return""},redEvent:function(){return""},playerEvent:function(e){var n,a;return'<table class="playerEventTable" id="'+e+'"><thead><th>'+t.currentGame.homeTeam.name+"</th><th>"+t.currentGame.awayTeam.name+"</th></thead><tr><td>\n"+("event-goal"===e?"<input type='button' value='автогол' class='playerEvent'/>":void 0)+"\n"+function(){var e,r;e=t.currentGame.homeTeam.players,r=[];for(n in e)a=e[n],r.push("<input type='button' id='"+n+"' class='playerEvent' value='"+a[0]+"'>");return r}().join("")+"\n</td><td>\n"+("event-goal"===e?"<input type='button' value='автогол' class='playerEvent'/>":void 0)+"\n"+function(){var e,r;e=t.currentGame.awayTeam.players,r=[];for(n in e)a=e[n],r.push("<input type='button' id='"+n+"' class='playerEvent' value='"+a[0]+"'>");return r}().join("")+'\n</td>\n</tr></table>\n<button id="saveEventBtn">OK</button>'},endEvent:function(){return'<button id="homeTeamChoise">выбор '+t.currentGame.homeTeam.name+'</button> <br>\n<button type="button" id="awayTeamChoise">выбор '+t.currentGame.awayTeam.name+'</button> <br>\n<button id="saveChoises">OK</button>'},choise:function(e){var n,a,r,i,o;return i=[],"Home"===e?(i=t.currentGame.awayTeam.players,o=t.currentGame.homeTeam):(i=t.currentGame.homeTeam.players,o=t.currentGame.awayTeam),'  <div class="strip">оценка судье:</div>\n<div>\n  '+function(){var t,n;for(n=[],a=t=2;5>=t;a=++t)n.push("<input type='button' class='playerEvent refereeMark mark"+e+" "+(a===o.refereeMark?"activeBtn":"")+"' value='"+a+"'>");return n}().join("")+'\n</div>\n  <br><div class="strip">лучшие игроки соперника:</div>\n  <div>\n  '+function(){var e;e=[];for(n in i)r=i[n],e.push("<input type='button' id='"+n+"' class='playerEvent bestPlayer "+(null!=r.star?"activeBtn":"")+"' value='"+r[0]+"'>");return e}().join("")+'\n  </div><br><button id="save'+e+'TeamChoise">OK</button>'},error:function(){return"error"}},e=function(e){var t;return t={},e.find("[data-value]").each(function(){return t[$(this).attr("data-value")]=$(this).val()}),e.find("[data-collection]").each(function(){var e;return e=$(this).attr("data-collection"),t[e]=[],$(this).find("[data-element]").each(function(){var n;return n={},$(this).find("[data-atom]").each(function(){return n[$(this).attr("data-atom")]=$(this).val()}),t[e].push(n)})}),t},t={},t.load=function(){var e,n,a,r;a=JSON.parse(localStorage.getItem("registry")),r=[];for(e in a)n=a[e],r.push(t[e]=n);return r},t.save=function(){return localStorage.setItem("registry",JSON.stringify(t))},t.sync=function(e){return console.log("здесь мы синхронизируем регистр с сервером"),"function"==typeof e?e():void 0},t.endGame=function(){return this.currentGame.ended=!0,this.sync(),this.save()},t.setCurrentGame=function(e){return this.currentGame=e,this.save()},t.setUser=function(e){return this.currentUser=e,this.save()},t.setHomeRefereeMark=function(e){return this.currentGame.homeTeam.refereeMark=parseInt(e),console.log("home",e,this.currentGame.homeTeam),this.save()},t.setAwayRefereeMark=function(e){return this.currentGame.awayTeam.refereeMark=parseInt(e),console.log("away",e,this.currentGame.awayTeam),this.save()},t.removeBestPlayer=function(e){return null!=this.currentGame.homeTeam.players[e]?delete this.currentGame.homeTeam.players[e].star:delete this.currentGame.awayTeam.players[e].star,this.save()},t.setBestPlayer=function(e){return null!=this.currentGame.homeTeam.players[e]?this.currentGame.homeTeam.players[e].star=!0:this.currentGame.awayTeam.players[e].star=!0,this.save()},t.setPlayerActivity=function(e,t){return null!=this.currentGame.homeTeam.players[e]?this.currentGame.homeTeam.players[e][2]=t:this.currentGame.awayTeam.players[e][2]=t,this.save()},t.load(),null==t.currentUser?$("#container").html(n.login()):null==t.currentGame?$.ajax({url:"/matches",method:"GET",success:function(e){return $("#container").html(n.matches(e))},error:function(){return $("#container").html(n.error)}}):$("#container").html(null==t.currentGame.ended?n.events():n.endEvent()),$("#container").on("click","#loginBtn",function(){var a;return $(this).html("...").attr("disabled","true"),a=e($(this).parent()),$.ajax({url:"/login",method:"POST",data:a,success:function(e){return t.setUser(!0),$("#container").html(n.matches(e))},error:function(){return $(this).html("Go!")}})}),$("#container").on("click",".match",function(){return $(this).parent().find(".match").each(function(){return $(this).attr("disabled",!0)}),$(this).html("..."),$.ajax({url:"/game?_id="+$(this).attr("id"),success:function(e){return t.setCurrentGame(e),$("#container").html(n.game(e))},error:function(){return $("#container").html(n.error())}})}),$("#container").on("click",".player",function(){return $(this).toggleClass("activePlayer"),t.setPlayerActivity($(this).attr("id"),$(this).hasClass("activePlayer"))}),$("#container").on("click","#saveHomeTeamBtn",function(){return $("#homeTeam").hide(),$("#awayTeam").show()}),$("#container").on("click","#saveAwayTeamBtn",function(){return t.sync(),$("#container").html(n.events())}),$("#container").on("click","#goalEvent",function(){return $("#container").html(n.goalEvent())}),$("#container").on("click","#yellowEvent",function(){return $("#container").html(n.yellowEvent())}),$("#container").on("click","#redEvent",function(){return $("#container").html(n.redEvent())}),$("#container").on("click","#endEvent",function(){return confirm("Закончить матч? Это действие нельзя будет отменить")?(t.endGame(),$("#container").html(n.endEvent())):void 0}),$("#container").on("click","#homeTeamChoise",function(){return $("#container").html(n.choise("Home"))}),$("#container").on("click","#awayTeamChoise",function(){return $("#container").html(n.choise("Away"))}),$("#container").on("click",".refereeMark",function(){return $(this).hasClass("markHome")?t.setHomeRefereeMark($(this).val()):t.setAwayRefereeMark($(this).val()),$(this).parent().find(".activeBtn").each(function(){return $(this).removeClass("activeBtn")}),$(this).addClass("activeBtn")}),$("#container").on("click",".bestPlayer",function(){return $(this).hasClass("activeBtn")?($(this).removeClass("activeBtn"),t.removeBestPlayer($(this).attr("id"))):$(this).parent().find(".activeBtn").length<3?($(this).addClass("activeBtn"),t.setBestPlayer($(this).attr("id"))):void 0}),$("#container").on("click","#saveHomeTeamChoise",function(){return $("#container").html(n.endEvent())}),$("#container").on("click","#saveAwayTeamChoise",function(){return $("#container").html(n.endEvent())}),$("#container").on("click","#saveChoises",function(){return $(this).html("..."),t.sync(function(){return location.reload()})}),$("#container").on("click","#event-goal input",function(){return 0===$(".playerEventTable .goal").length?$(this).addClass("goal"):$(this).hasClass("goal")?$(this).removeClass("goal"):$(this).hasClass("assist")?$(this).removeClass("assist"):$(this).addClass("assist")}),$("#container").on("click","#saveEvent",function(){return console.log("ok")})})}).call(this);