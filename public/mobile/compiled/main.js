(function(){$(function(){var t,n,e;return e={login:function(){return'<div id="loginForm">\n<input type="text" data-value="login" placeholder=\'login\' autofocus=\'true\'><br><br>\n<input type="password" data-value="password" placeholder=\'password\'><br><br>\n<button id="loginBtn">Go!</button>\n</div>'},matches:function(t){var n;return function(){var e,a,r;for(r=[],e=0,a=t.length;a>e;e++)n=t[e],r.push("<button id='"+n._id+"'class='match'>"+n.homeTeamName+" - "+n.awayTeamName+"<br><span class='littleText'>"+n.date+" "+n.time+" "+n.placeName+"</span></button><br>");return r}().join("")},game:function(t){var n,e;return'<div id="homeTeam">\n  <b>'+t.homeTeam.name+"</b>\n  "+function(){var a,r;a=t.homeTeam.players,r=[];for(n in a)e=a[n],r.push("<button id='"+n+"' class='player homePlayer'>"+e[0]+" "+e[1]+"</button>");return r}().join("")+'\n  <button id="saveHomeTeamBtn">OK</button>\n</div>\n\n<div id="awayTeam" style=\'display: none\'>\n  '+function(){var a,r;a=t.awayTeam.players,r=[];for(n in a)e=a[n],r.push("<button id='"+n+"' class='player awayPlayer'>"+e[0]+" "+e[1]+"</button>");return r}().join("")+'\n  <button id="saveAwayTeamBtn">OK</button>\n</div>'},events:function(){return'<button class="event" id="goalEvent">Гол</button><br>\n<button class="event" id="yellowEvent">Жк</button><br>\n<button class="event" id="redEvent">Кк</button><br>\n<button class="event" id="endEvent">Конец матча</button><br>'},goalEvent:function(){return""},yellowEvent:function(){return""},redEvent:function(){return""},playerEvent:function(t){var e,a;return'<table class="playerEventTable" id="'+t+'"><thead><th>'+n.currentGame.homeTeam.name+"</th><th>"+n.currentGame.awayTeam.name+"</th></thead><tr><td>\n"+("event-goal"===t?"<input type='button' value='автогол' class='playerEvent'/>":void 0)+"\n"+function(){var t,r;t=n.currentGame.homeTeam.players,r=[];for(e in t)a=t[e],r.push("<input type='button' id='"+e+"' class='playerEvent' value='"+a[0]+"'>");return r}().join("")+"\n</td><td>\n"+("event-goal"===t?"<input type='button' value='автогол' class='playerEvent'/>":void 0)+"\n"+function(){var t,r;t=n.currentGame.awayTeam.players,r=[];for(e in t)a=t[e],r.push("<input type='button' id='"+e+"' class='playerEvent' value='"+a[0]+"'>");return r}().join("")+'\n</td>\n</tr></table>\n<button id="saveEventBtn">OK</button>'},endEvent:function(){return'<button id="homeTeamChoise">выбор '+n.currentGame.homeTeam.name+'</button> <br>\n<button type="button" id="awayTeamChoise">выбор '+n.currentGame.awayTeam.name+'</button> <br>\n<button id="saveChoises" '+(n.choisesMade?void 0:"enabled=false")+">OK</button>"},choise:function(t){var e,a,r,o;return o=[],o="home"===t?n.currentGame.awayTeam.players:n.currentGame.homeTeam.players,'  <div class="strip">оценка судье:</div>\n  '+function(){var t,n;for(n=[],a=t=2;5>=t;a=++t)n.push("<input type='button' class='playerEvent refereeMark' value='"+a+"'>");return n}().join("")+'\n<br><br><div class="strip">лучшие игроки соперника:</div>\n  '+function(){var t;t=[];for(e in o)r=o[e],t.push("<input type='button' id='"+e+"' class='playerEvent' value='"+r[0]+"'>");return t}().join("")+'\n  <br><br><button id="saveTeamChoise" '+(n.choisesMade?void 0:"disabled")+">OK</button>"},error:function(){return"error"}},t=function(t){var n;return n={},t.find("[data-value]").each(function(){return n[$(this).attr("data-value")]=$(this).val()}),t.find("[data-collection]").each(function(){var t;return t=$(this).attr("data-collection"),n[t]=[],$(this).find("[data-element]").each(function(){var e;return e={},$(this).find("[data-atom]").each(function(){return e[$(this).attr("data-atom")]=$(this).val()}),n[t].push(e)})}),n},n={},n.load=function(){var t,e,a,r;a=JSON.parse(localStorage.getItem("registry")),r=[];for(t in a)e=a[t],r.push(n[t]=e);return r},n.save=function(){return localStorage.setItem("registry",JSON.stringify(n))},n.sync=function(){return console.log("здесь мы синхронизируем регистр с сервером")},n.endGame=function(){return this.currentGame.ended=!0,this.sync(),this.save()},n.setCurrentGame=function(t){return this.currentGame=t,this.save()},n.setUser=function(t){return this.currentUser=t,this.save()},n.setPlayerActivity=function(t,n){return null!=this.currentGame.homeTeam.players[t]?this.currentGame.homeTeam.players[t][2]=n:this.currentGame.awayTeam.players[t][2]=n,this.save()},n.load(),null==n.currentUser?$("#container").html(e.login()):null==n.currentGame?$.ajax({url:"/matches",method:"GET",success:function(t){return $("#container").html(e.matches(t))},error:function(){return $("#container").html(e.error)}}):$("#container").html(null==n.currentGame.ended?e.events():e.endEvent()),$("#container").on("click","#loginBtn",function(){var a;return $(this).html("...").attr("disabled","true"),a=t($(this).parent()),$.ajax({url:"/login",method:"POST",data:a,success:function(t){return n.setUser(!0),$("#container").html(e.matches(t))},error:function(){return $(this).html("Go!")}})}),$("#container").on("click",".match",function(){return $(this).parent().find(".match").each(function(){return $(this).attr("disabled",!0)}),$(this).html("..."),$.ajax({url:"/game?_id="+$(this).attr("id"),success:function(t){return n.setCurrentGame(t),$("#container").html(e.game(t))},error:function(){return $("#container").html(e.error())}})}),$("#container").on("click",".player",function(){return $(this).toggleClass("activePlayer"),n.setPlayerActivity($(this).attr("id"),$(this).hasClass("activePlayer"))}),$("#container").on("click","#saveHomeTeamBtn",function(){return $("#homeTeam").hide(),$("#awayTeam").show()}),$("#container").on("click","#saveAwayTeamBtn",function(){return n.sync(),$("#container").html(e.events())}),$("#container").on("click","#goalEvent",function(){return $("#container").html(e.goalEvent())}),$("#container").on("click","#yellowEvent",function(){return $("#container").html(e.yellowEvent())}),$("#container").on("click","#redEvent",function(){return $("#container").html(e.redEvent())}),$("#container").on("click","#endEvent",function(){return confirm("Закончить матч? Это действие нельзя будет отменить")?(n.endGame(),$("#container").html(e.endEvent())):void 0}),$("#container").on("click","#homeTeamChoise",function(){return $("#container").html(e.choise("home"))}),$("#container").on("click","#awayTeamChoise",function(){return $("#container").html(e.choise("away"))}),$("#container").on("click","#event-goal input",function(){return 0===$(".playerEventTable .goal").length?$(this).addClass("goal"):$(this).hasClass("goal")?$(this).removeClass("goal"):$(this).hasClass("assist")?$(this).removeClass("assist"):$(this).addClass("assist")}),$("#container").on("click","#saveEvent",function(){return console.log("ok")})})}).call(this);