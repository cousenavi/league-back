// Generated by CoffeeScript 1.4.0

(function($) {
  var templates;
  templates = {
    table: function(rows) {
      return "<table class=\"table\">" + (rows.join('')) + "</table>";
    },
    row: function(game) {
      var computePlayers;
      computePlayers = function(protocol) {
        var formattedPlayers, key, pl, players, _i, _j, _len, _len1;
        players = [];
        for (_i = 0, _len = protocol.length; _i < _len; _i++) {
          pl = protocol[_i];
          if (pl.goals > 0) {
            players.push({
              name: pl.name,
              goals: pl.goals
            });
          }
        }
        players.sort(function(a, b) {
          if (a.goals < b.goals) {
            return 1;
          } else {
            return -1;
          }
        });
        formattedPlayers = "";
        for (key = _j = 0, _len1 = players.length; _j < _len1; key = ++_j) {
          pl = players[key];
          pl.name = pl.name.split(' ')[0].toLowerCase();
          pl.name = pl.name.charAt(0).toUpperCase() + pl.name.slice(1);
          formattedPlayers += ' ' + pl.name;
          if (pl.goals > 1) {
            formattedPlayers += "(" + pl.goals + ")";
          }
          if (key < players.length - 1) {
            formattedPlayers += ',';
          }
        }
        return "<div class='players'>" + formattedPlayers + "</div>";
      };
      return "<tr><td><img src =\"" + game.homeTeamLogo + "\"></td>\n    <td>" + game.homeTeamName + "\n      " + (game.homeTeamPlayers != null ? computePlayers(game.homeTeamPlayers) : '') + "\n    </td>\n    <td class=\"score\"> " + (game.homeTeamScore != null ? "" + game.homeTeamScore + " - " + game.awayTeamScore : (game.time != null ? game.date + " " + game.time : game.date)) + " </td>\n    <td>" + game.awayTeamName + "</td><td><img src =\"" + game.awayTeamLogo + "\"></td></tr>";
    }
  };
  return $.fn.calendar = function(leagueId, startDate, endDate) {
    var _this = this;
    if (!leagueId || !startDate || !endDate) {
      throw 'not enough parameters';
    }
    $.getJSON("/games/?leagueId=" + leagueId + "&startDate=" + startDate + "&endDate=" + endDate + "&showPlayers=1").then(function(games) {
      var gm;
      return _this.html(templates.table((function() {
        var _i, _len, _results;
        _results = [];
        for (_i = 0, _len = games.length; _i < _len; _i++) {
          gm = games[_i];
          _results.push(templates.row(gm));
        }
        return _results;
      })()));
    });
    return this.html(leagueId);
  };
})(jQuery);
